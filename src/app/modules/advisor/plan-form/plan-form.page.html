<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="goBack()" text="" defaultHref="/advisor/dashboard"></ion-back-button>
    </ion-buttons>
    <div class="header-logo">
      <img src="assets/images/logoTigo.png" alt="TigoConnect" class="header-logo-img">
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="plan-form-content">
  <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

  <form [formGroup]="planForm" (ngSubmit)="submitForm()" *ngIf="!isLoading" class="form-container">
    <div class="form-header">
      <h1>{{ editingPlanId ? 'Editar Plan' : 'Crear Nuevo Plan' }}</h1>
      <p>Configura los detalles de tu plan móvil</p>
    </div>

    <div class="image-section">
      <div class="image-upload-area" *ngIf="!imagePreview">
        <ion-icon name="image-outline"></ion-icon>
        <p>Sube una imagen para tu plan</p>
        <input 
          type="file" 
          accept="image/jpeg,image/png" 
          (change)="onImageSelected($event)"
          hidden
          #imageInput
        >
        <ion-button 
          type="button"
          class="upload-btn"
          (click)="imageInput.click()"
        >
          <ion-icon slot="start" name="cloud-upload-outline"></ion-icon>
          Seleccionar Imagen
        </ion-button>
      </div>

      <div class="image-preview" *ngIf="imagePreview">
        <img [src]="imagePreview" alt="Vista previa">
        <ion-button 
          type="button"
          class="remove-btn"
          (click)="imagePreview = null; selectedImage = null"
        >
          <ion-icon slot="start" name="close-outline"></ion-icon>
          Cambiar
        </ion-button>
      </div>
    </div>

    <div class="form-section">
      <h2 class="section-title">
        <ion-icon name="information-circle-outline"></ion-icon>
        Información General
      </h2>

      <div class="form-group">
        <label>Nombre del Plan</label>
        <div class="input-wrapper">
          <ion-icon name="document-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="nombre"
            placeholder="Ej: Plan Smart 5GB"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Descripción</label>
        <textarea 
          formControlName="descripcion"
          placeholder="Describe el plan..."
          rows="3"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Precio Mensual ($)</label>
        <div class="input-wrapper">
          <ion-icon name="cash-outline"></ion-icon>
          <input 
            type="number" 
            formControlName="precio"
            placeholder="15.99"
            step="0.01"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Segmento</label>
        <div class="input-wrapper">
          <ion-icon name="layers-outline"></ion-icon>
          <select formControlName="segmento">
            <option value="">Selecciona un segmento</option>
            <option *ngFor="let seg of segmentos" [value]="seg">
              {{ seg }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h2 class="section-title">
        <ion-icon name="settings-outline"></ion-icon>
        Características del Plan
      </h2>

      <div class="form-group">
        <label>Datos Móviles</label>
        <div class="input-wrapper">
          <ion-icon name="call-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="datos_moviles"
            placeholder="Ej: 5 GB mensuales"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Minutos de Voz</label>
        <div class="input-wrapper">
          <ion-icon name="mic-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="minutos_voz"
            placeholder="Ej: 100 minutos nacionales"
          />
        </div>
      </div>

      <div class="form-group">
        <label>SMS</label>
        <div class="input-wrapper">
          <ion-icon name="mail-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="sms"
            placeholder="Ej: Ilimitados"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Velocidad 4G</label>
        <div class="input-wrapper">
          <ion-icon name="speed-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="velocidad_4g"
            placeholder="Ej: Hasta 50 Mbps"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Velocidad 5G (Opcional)</label>
        <div class="input-wrapper">
          <ion-icon name="wifi-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="velocidad_5g"
            placeholder="Ej: Hasta 300 Mbps"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Redes Sociales</label>
        <div class="input-wrapper">
          <ion-icon name="share-social-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="redes_sociales"
            placeholder="Ej: Ilimitadas"
          />
        </div>
      </div>

      <div class="form-group">
        <label>WhatsApp</label>
        <div class="input-wrapper">
          <ion-icon name="logo-whatsapp"></ion-icon>
          <input 
            type="text" 
            formControlName="whatsapp"
            placeholder="Ej: Ilimitado"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Llamadas Internacionales</label>
        <div class="input-wrapper">
          <ion-icon name="earth-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="llamadas_internacionales"
            placeholder="Ej: $0.15/min"
          />
        </div>
      </div>

      <div class="form-group">
        <label>Roaming</label>
        <div class="input-wrapper">
          <ion-icon name="airplane-outline"></ion-icon>
          <input 
            type="text" 
            formControlName="roaming"
            placeholder="Ej: No incluido"
          />
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="checkbox-group">
        <input 
          type="checkbox" 
          formControlName="activo"
          id="activoPlan"
        />
        <label for="activoPlan">Plan Activo</label>
      </div>
    </div>

    <div class="button-group">
      <ion-button 
        expand="block" 
        type="submit"
        [disabled]="planForm.invalid || isSubmitting"
        class="submit-btn"
      >
        <ion-icon slot="start" name="checkmark-done-outline"></ion-icon>
        <ion-spinner *ngIf="isSubmitting" name="dots"></ion-spinner>
        <span *ngIf="!isSubmitting">
          {{ editingPlanId ? 'Guardar Cambios' : 'Crear Plan' }}
        </span>
      </ion-button>

      <ion-button 
        expand="block" 
        fill="outline"
        type="button"
        (click)="goBack()"
        class="cancel-btn"
      >
        <ion-icon slot="start" name="close-outline"></ion-icon>
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>
